<!DOCTYPE html>
<html>

<head>
    <title>Cover Your Case - Request Coverage</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/jquery"></script>
    <script src="https://unpkg.com/react@15/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.2.5/babel.min.js"></script>
    <script src="https://surveyjs.azureedge.net/1.0.71/survey.react.js"></script>
    <link href="https://surveyjs.azureedge.net/1.0.71/survey.css" type="text/css" rel="stylesheet" />
    <style type='text/css'>



    </style>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/dependencyLibs/inputmask.dependencyLib.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/inputmask.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/inputmask.extensions.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/inputmask.numeric.extensions.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/inputmask.date.extensions.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/inputmask.phone.extensions.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/phone-codes/phone.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/phone-codes/phone-be.js"></script>
    <script src="https://unpkg.com/inputmask@3.3.11/dist/inputmask/phone-codes/phone-ru.js"></script>
    <script src="https://unpkg.com/surveyjs-widgets/surveyjs-widgets.js"></script>

</head>

<body>
    <div id="surveyElement">
    </div>
    <div id="surveyResult"></div>

    <script type="text/babel">



        Survey.StylesManager.applyTheme("default");
    


var json = {
 completedHtml: "Thank you for your request, we will be in touch for your case.",
 pages: [
  {
   name: "Location",
   elements: [
    {
     type: "dropdown",
     name: "County",
     title: "County",
     isRequired: true,
     choices: [
      "Cook County",
      "DeKalb County",
      "Dupage County",
      "Grundy County",
      "Kane County",
      "Kendall County",
      "McHenry County",
      "Will County"
     ],
     choicesOrder: "asc"
    },
    {
     type: "dropdown",
     name: "Courthouse",
     isRequired: true,
     choices: [
      {
       value: "Richard J. Daley Center",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "2nd Municipal District - Skokie",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "3rd Municipal District - Rolling Meadows",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "4th Municipal District - Maywood",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "5th Municipal District - Bridgeview",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Branch 23 & 29 - Chicago",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Branch 35 & 38 - Chicago",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Branch 43 & 44 - Chicago",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Central Bond Court - Pretrial Division",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Dirksen Federal Court - Chicago",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Domestic Violence Courthouse",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "George N. Leighton Criminal Courthouse",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Juvenile Center",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "Marriage and Civil Union Court - Chicago",
       visibleIf: "{County} = \"Cook County\""
      },
      {
       value: "DuPage County Courthouse and Administration Building",
       visibleIf: "{County} = \"Dupage County\""
      },
      {
       value: "Addison Field Court",
       visibleIf: "{County} = \"Dupage County\""
      },
      {
       value: "Downers Grove Field Court",
       visibleIf: "{County} = \"Dupage County\""
      },
      {
       value: "Glendale Heights Field Court",
       visibleIf: "{County} = \"Dupage County\""
      },
      {
       value: "Wheaton Field Court",
       visibleIf: "{County} = \"Dupage County\""
      }
     ]
    }
   ]
  },
  {
   name: "When",
   elements: [
    {
     type: "text",
     name: "Date",
     isRequired: true,
     inputType: "date"
    },
    {
     type: "text",
     name: "Time",
     isRequired: true,
     inputType: "time"
    }
   ]
  },
  {
   name: "Court",
   elements: [
    {
     type: "dropdown",
     name: "Courtroom",
     isRequired: true,
     choices: [
      {
       value: "2401",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2609",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2010",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2404",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2110",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2304",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2309",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "2103",
       visibleIf: "{Courthouse} = \"Richard J. Daley Center\""
      },
      {
       value: "101",
       visibleIf: "{Courthouse} = \"2nd Municipal District - Skokie\""
      },
      {
       value: "106",
       visibleIf: "{Courthouse} = \"2nd Municipal District - Skokie\""
      },
      {
       value: "202",
       visibleIf: "{Courthouse} = \"2nd Municipal District - Skokie\""
      },
      {
       value: "206",
       visibleIf: "{Courthouse} = \"2nd Municipal District - Skokie\""
      },
      {
       value: "219",
       visibleIf: "{Courthouse} = \"2nd Municipal District - Skokie\""
      },
      {
       value: "108",
       visibleIf: "{Courthouse} = \"3rd Municipal District - Rolling Meadows\""
      },
      {
       value: "106",
       visibleIf: "{Courthouse} = \"3rd Municipal District - Rolling Meadows\""
      },
      {
       value: "204",
       visibleIf: "{Courthouse} = \"3rd Municipal District - Rolling Meadows\""
      },
      {
       value: "205L",
       visibleIf: "{Courthouse} = \"3rd Municipal District - Rolling Meadows\""
      }
     ],
     choicesOrder: "asc"
    },
    {
     type: "dropdown",
     name: "Division",
     isRequired: true,
     choices: [
      "Chancery",
      "Civil",
      "Criminal",
      "Domestic Relations",
      "Law",
      "Probate"
     ]
    },
    {
     type: "text",
     name: "Judge Name"
    }
   ]
  },
  {
   name: "Case Information",
   elements: [
    {
     type: "text",
     name: "Case Number",
     isRequired: true
    },
    {
     type: "text",
     name: "Case Name",
     title: "Case Name",
     isRequired: true
    },
    {
     type: "dropdown",
     name: "question3",
     title: "Practice Area",
     choices: [
      "Collections",
      "Family Law",
      "Foreclosure",
      "Landlord/Tennant",
      "Personal Injury",
      "Probate",
      "Real Estate"
     ],
     choicesOrder: "asc"
    },
    {
     type: "text",
     name: "Instructions",
     title: "Instructions"
    },
    {
     type: "file",
     name: "Attachments",
     maxSize: 0
    }
   ]
  }
 ],
 sendResultOnPageNext: true,
 showQuestionNumbers: "off",
 showProgressBar: "top"
};

window.survey = new Survey.Model(json);


survey.onComplete.add(function(result) {
    //TODO: send data to lambda
    sendLambda(result);
});

var storageName = "survey_patient_history";
function saveSurveyData(survey) {
    var data = survey.data;
    data.pageNo = survey.currentPageNo;
    window.localStorage.setItem(storageName, JSON.stringify(data));
}
survey.onPartialSend.add(function(survey){
    saveSurveyData(survey);
});
survey.onComplete.add(function(survey, options){
    saveSurveyData(survey);
});

survey.sendResultOnPageNext = true;
var prevData = window.localStorage.getItem(storageName) || null;
if(prevData) {
    var data = JSON.parse(prevData);
    survey.data = data;
    if(data.pageNo) {
        survey.currentPageNo = data.pageNo;
    }
}
ReactDOM.render(<Survey.Survey model={survey}  />, document.getElementById("surveyElement"));

function sendLambda(result){
        // Example POST method implementation:

postData(`https://r40skemfvf.execute-api.us-east-1.amazonaws.com/web`, result.data)
  .then(data => {
      console.log(JSON.stringify(data));
  document.querySelector('#surveyResult').innerHTML = data;
}
  ) // JSON-string from `response.json()` call
  .catch(error => {
      console.error(error);
  document.querySelector('#surveyResult').innerHTML = JSON.stringify(error);
}
)

function postData(url = ``, data = {}) {
  // Default options are marked with *
    return fetch(url, {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, cors, *same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, *same-origin, omit
        headers: {
            "Content-Type": "application/json",
            // "Content-Type": "application/x-www-form-urlencoded",
        },
        redirect: "follow", // manual, *follow, error
        referrer: "no-referrer", // no-referrer, *client
        body: JSON.stringify(data), // body data type must match "Content-Type" header
    })
    .then(response => response.json()); // parses response to JSON
}
}
</script>
    <footer class="footer"><img alt="Cover your case logo"
            src="https://raw.githubusercontent.com/cover-your-case/logo/master/logo.png" width="25%"
            style="margin-left: 40%"></footer>
</body>

</html>